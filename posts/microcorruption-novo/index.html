<!doctype html><html><meta charset=utf-8><meta name=generator content="Hugo 0.114.1"><meta name=viewport content="width=device-width,initial-scale=1,viewport-fit=cover"><meta name=color-scheme content="light dark"><meta name=supported-color-schemes content="light dark"><title>MicroCorruption: Novosibirsk&nbsp;&ndash;&nbsp;The Mess Of Nebula</title><link rel=stylesheet href=/css/core.min.3dff9636f60da21a7bce297e09d08d8f636d1b8e7def5079c790207b0c0dfdc945858b105a0c7fc6c4a0b4f9ae05e8d3.css integrity=sha384-Pf+WNvYNohp7zil+CdCNj2NtG45971B5x5AgewwN/clFhYsQWgx/xsSgtPmuBejT><body><div class="base-body max-width"><section id=header class="header max-body-width"><div class=header-wrap><div class=header-left-side><a class=home href=/><span class=site-name>The Mess Of Nebula</span><span class=site-slogan>Gravitations towards point origin</span></a></div><div class=header-right-side><div class=nav-wrap><div class=nav><a class=site-tag href=/categories/>Categories</a><a class=site-tag href=/tags/>Tags</a><a class=site-tag href=/about>About</a></div></div></div></div></section><div id=content class="flex-body max-body-width"><section class=article-header><h1>MicroCorruption: Novosibirsk</h1><p class=article-date>2020-11-03</p></section><article class=markdown-body><p><a target=_blank rel="noopener noreferrer" href=/images/microcorruption/novo/novo.jpg><img class=img src=/images/microcorruption/novo/novo.jpg alt></a></p><p>but a manual:</p><p><a target=_blank rel="noopener noreferrer" href=/images/microcorruption/novo/nov-dets.png><img class=img src=/images/microcorruption/novo/nov-dets.png alt></a></p><ul><li>The lock is <strong>attached to LockIT Pro HSM-2.</strong></li><li>Features have been added from the <strong>b.03</strong> to the hardware.</li><li>Passwords <strong>can not be too long.</strong></li></ul><p>So this hardware version differs from <em>b.03</em> in that HSM-2 is what is connected to port 2.</p><p><a target=_blank rel="noopener noreferrer" href=/images/microcorruption/novo/novo-hsm2.png><img class=img src=/images/microcorruption/novo/novo-hsm2.png alt></a></p><p>Also, <em>passwords cannot be too long</em>. Mmmh?</p><p>The <code>main</code> function:</p><p><a target=_blank rel="noopener noreferrer" href=/images/microcorruption/novo/nov-login.png><img class=img src=/images/microcorruption/novo/nov-login.png alt></a></p><ul><li><p>The input buffer for username:</p><ul><li><code>r14</code>: Holds the length of the input buffer: <code>0x1f4 (500)</code> characters. <strong>Odd</strong>ly long.</li><li><code>r15</code>: Address to the input buffer is at <code>0x2400</code>.</li></ul></li><li><p>A call to <code>strcpy()</code> is made:</p><ul><li><code>src</code>: the content at address held at <code>r14</code> -> <code>0x2400</code>(Your input buffer is held here).</li><li><code>dst</code>: copy <code>src</code> to address held at <code>r15</code> -> <code>0x420c</code>.</li></ul></li></ul><p><a target=_blank rel="noopener noreferrer" href=/images/microcorruption/novo/nov-str-add.png><img class=img src=/images/microcorruption/novo/nov-str-add.png alt></a></p><ul><li>The copied content at <code>0x420c</code> is printed back using <code>printf()</code>.</li><li>A value <code>0xa(10)</code> is set at <code>r15</code> via the <code>putchar</code> function.</li><li><code>0xa</code>(value at <code>r15</code>) and the copied content is passed and the function <code>conditional_unlock_door</code> called.</li></ul><p>There are a lot of clues here.</p><p>First, the call to <code>printf()</code> makes you think of format specifiers. This you encountered at a previous lock in Addis Ababa: <a href=https://evalevanto.github.io/blog/microcorruption-addis/ target=_blank>revisit notes</a>. These can be exploited modify value in memory(<code>%n</code>).</p><p>Attempts:</p><ol><li>Can return address(at <code>sp</code>) be modified?</li></ol><blockquote><p>The input buffer length is 500 characters. Even with this though, no memory overwrite occurs. The return address is not modified.</p><p>This implies that you cannot use shellcode injection in the input. (since you can not jump back to the shellcode address).</p></blockquote><p><a target=_blank rel="noopener noreferrer" href=/images/microcorruption/novo/nov-sp.png><img class=img src=/images/microcorruption/novo/nov-sp.png alt></a></p><ol start=2><li>Can the <code>putchar</code> function be beneficial somehow? Since it sets a value at <code>r15</code> which is passed to the <code>conditional_unlock_door</code>?</li></ol><p>A look at the <code>put_char</code> function:</p><p><a target=_blank rel="noopener noreferrer" href=/images/microcorruption/novo/nov-put-char.png><img class=img src=/images/microcorruption/novo/nov-put-char.png alt></a></p><blockquote><p>Interesting&mldr;<br>The byte value at <code>r15</code> is passed to <code>INT 0</code> which displays it. Mmmh! What if the operation at address <code>0x4552</code> is overwritten such that the INT of value at <code>r15</code> is called instead?</p></blockquote><p><a target=_blank rel="noopener noreferrer" href=/images/microcorruption/novo/nov-INT-0.png><img class=img src=/images/microcorruption/novo/nov-INT-0.png alt></a></p><p>What if <code>7f</code> is passed ? In such a case, where the operation at <code>0x4552</code> is cancelled, passing<code>7f</code> at <code>r15</code> would call <code>int 7f</code>!</p><p><a target=_blank rel="noopener noreferrer" href=/images/microcorruption/novo/nov-int-7f.png><img class=img src=/images/microcorruption/novo/nov-int-7f.png alt></a></p><ul><li>You need an input that modifies the value at address <code>0x4552</code>(cancelling the operation) and also passes <code>7f</code>.</li><li>Use format specifier <code>%n</code>.</li></ul><p><a target=_blank rel="noopener noreferrer" href=/images/microcorruption/novo/nov-correct.png><img class=img src=/images/microcorruption/novo/nov-correct.png alt></a></p><p>During printing back the copied input to display at the input byte <code>7f</code>, this is what happens now&mldr;</p><p><a target=_blank rel="noopener noreferrer" href=/images/microcorruption/novo/nov-sr.png><img class=img src=/images/microcorruption/novo/nov-sr.png alt></a></p><p>aaand&mldr;</p><p><a target=_blank rel="noopener noreferrer" href=/images/microcorruption/door-unlocked.png><img class=img src=/images/microcorruption/door-unlocked.png alt></a></p><blockquote><p>браво!</p><p>Onwards! There&rsquo;s nothing Wayang you down now :)</p></blockquote></article><section class=article-labels><a class="article-category li" href=/categories/reverse-engineering/><span class=hashtag>#</span>Reverse Engineering</a><a class="article-category li" href=/categories/micro-corruption/><span class=hashtag>#</span>Micro Corruption</a><a class="article-tag li" href=/tags/format-specifiers/><span class=hashtag>#</span>format specifiers</a></section><section class=article-navigation><p><a class=link href=/posts/microcorruption-cruz/><span class=li></span>MicroCorruption: Santa Cruz</a></p><p><a class=link href=/posts/microcorruption-addis/><span class=li></span>MicroCorruption: Addis Ababa</a class="link"></p></section><section class=article-discussion><div id=disqus_thread></div><script type=application/javascript>window.disqus_config=function(){},function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById("disqus_thread").innerHTML="Disqus comments not available by default when the website is previewed locally.";return}var t=document,e=t.createElement("script");e.async=!0,e.src="//the-mess-of-nebula.disqus.com/embed.js",e.setAttribute("data-timestamp",+new Date),(t.head||t.body).appendChild(e)}()</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></section></div><section id=footer class="footer max-body-width"><p>© 2023 Eva Levanto</p><p><span>Powered by </span><a href=https://gohugo.io>Hugo</a><span> and the </span><a href=https://themes.gohugo.io/hugo-notepadium/>Notepadium</a></p></section><script defer type=text/javascript src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/MathJax.js?config=TeX-AMS-MML_HTMLorMML" integrity=sha384-e/4/LvThKH1gwzXhdbY2AsjR3rm7LHWyhIG5C0jiRfn8AN2eTN5ILeztWw0H9jmN crossorigin=anonymous>MathJax.Hub.Config({tex2jax:{inlineMath:[["$","$"],["\\(","\\)"]],displayMath:[["$$","$$"]],processEscapes:!0,processEnvironments:!0,skipTags:["script","noscript","style","textarea","pre"],TeX:{equationNumbers:{autoNumber:"AMS"},extensions:["AMSmath.js","AMSsymbols.js"]}}}),MathJax.Hub.Queue(function(){var e,t=MathJax.Hub.getAllJax();for(e=0;e<t.length;e+=1)t[e].SourceElement().parentNode.className+=" has-jax"}),MathJax.Hub.Config({TeX:{equationNumbers:{autoNumber:"AMS"}}})</script><script type=application/javascript>var doNotTrack=!1;doNotTrack||(window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","your-google-analytics-id","auto"),ga("send","pageview"))</script><script async src=https://www.google-analytics.com/analytics.js></script></div></body></html>