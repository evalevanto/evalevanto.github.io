<!doctype html><html><meta charset=utf-8><meta name=generator content="Hugo 0.118.2"><meta name=viewport content="width=device-width,initial-scale=1,viewport-fit=cover"><meta name=color-scheme content="light dark"><meta name=supported-color-schemes content="light dark"><title>MicroCorruption: New Orleans&nbsp;&ndash;&nbsp;The Mess Of Nebula</title><link rel=stylesheet href=/css/core.min.3dff9636f60da21a7bce297e09d08d8f636d1b8e7def5079c790207b0c0dfdc945858b105a0c7fc6c4a0b4f9ae05e8d3.css integrity=sha384-Pf+WNvYNohp7zil+CdCNj2NtG45971B5x5AgewwN/clFhYsQWgx/xsSgtPmuBejT><body><div class="base-body max-width"><section id=header class="header max-body-width"><div class=header-wrap><div class=header-left-side><a class=home href=/><span class=site-name>The Mess Of Nebula</span><span class=site-slogan>Gravitations towards point origin</span></a></div><div class=header-right-side><div class=nav-wrap><div class=nav><a class=site-tag href=/categories/>Categories</a><a class=site-tag href=/tags/>Tags</a><a class=site-tag href=/about>About</a></div></div></div></div></section><div id=content class="flex-body max-body-width"><section class=article-header><h1>MicroCorruption: New Orleans</h1><p class=article-date>2020-08-26</p></section><article class=markdown-body><p><a target=_blank rel="noopener noreferrer" href=/images/microcorruption/New-Orleans.jpg><img class=img src=/images/microcorruption/New-Orleans.jpg alt></a></p><p>You find a manual for the LockIT Pro Lock:</p><p><a target=_blank rel="noopener noreferrer" href=/images/microcorruption/New-Orleans-details.png><img class=img src=/images/microcorruption/New-Orleans-details.png alt></a></p><p>You learn some things from the manual:</p><ul><li>It is <strong>not attached</strong> to a HSM module.</li><li>Password set by entering it on the app restarting the lock.</li></ul><p>You are presented with a live debugger, a live memory dump, a disassembler and a view of the register states.</p><p>Looking through the main you notice a <code>create_password</code> function that gets called before the input is required or a check for correct input is done.</p><p><a target=_blank rel="noopener noreferrer" href=/images/microcorruption/New-Orleans-main.png><img class=img src=/images/microcorruption/New-Orleans-main.png alt></a></p><p>You do a quick run of the program with a dummy input <code>test</code> to follow through the flow.
This is how the <code>create_password</code> is like:</p><p><a target=_blank rel="noopener noreferrer" href=/images/microcorruption/New-Orleans-create-password.png><img class=img src=/images/microcorruption/New-Orleans-create-password.png alt></a></p><p>A password is clearly generated and stored at address <code>0x2400</code>. The input you put in is stored at address <code>0x439c</code></p><p><a target=_blank rel="noopener noreferrer" href=/images/microcorruption/New-Orleans-created-password.png><img class=img src=/images/microcorruption/New-Orleans-created-password.png alt></a></p><p>So, flowing back through <code>main</code>, <code>create_password</code> generates and stores a password at <code>0x2400</code> -> <code>get_password</code> scans and stores user input at <code>0x439c</code> -> then next instruction calls <code>check_password</code>.</p><p>Already there&rsquo;s a hunch that the created password is what is compared to your input&mldr; but you want to see it. :)</p><p><a target=_blank rel="noopener noreferrer" href=/images/microcorruption/New-Orleans-analyse-cmp.png><img class=img src=/images/microcorruption/New-Orleans-analyse-cmp.png alt></a></p><p>In the <code>check_password</code> function:</p><ul><li>A <code>cmp.b</code> instruction is called for each byte of the input(<code>r13</code> points to the input) and the created password.</li></ul><p>In pseudocode:</p><pre tabindex=0><code>r14 = 0
r13 = 0x439c
for r14 != 8{
	r13 += r14
	if *r13 != *(0x2400 + r14){
		r15 = 0
		return
	}
	r14++
}
r15 = 1
return
</code></pre><blockquote><p>Keep comparing the byte of the input at index(r14) to the byte of the created password at index(r14). If they are not equal, clear r15(becomes zero) and return. If they are equal, repeat for each byte until 8(this is the required length of the password). Set r15 to 1 and return.</p></blockquote><p>Falling back to <code>main</code>, only if <code>r15</code> is not zero does the door unlock.</p><p><a target=_blank rel="noopener noreferrer" href=/images/microcorruption/New-Orleans-test.png><img class=img src=/images/microcorruption/New-Orleans-test.png alt></a></p><p>You now put in the correct input: the created password:</p><p><a target=_blank rel="noopener noreferrer" href=/images/microcorruption/New-Orleans-correct-input.png><img class=img src=/images/microcorruption/New-Orleans-correct-input.png alt></a></p><p>And the door unlocks to you!!</p><p><a target=_blank rel="noopener noreferrer" href=/images/microcorruption/door-unlocked.png><img class=img src=/images/microcorruption/door-unlocked.png alt></a></p><p>Off to Sydney :)</p></article><section class=article-labels><a class="article-category li" href=/categories/reverse-engineering/><span class=hashtag>#</span>Reverse Engineering</a><a class="article-category li" href=/categories/micro-corruption/><span class=hashtag>#</span>Micro Corruption</a><a class="article-tag li" href=/tags/input-check/><span class=hashtag>#</span>input check</a></section><section class=article-navigation><p><a class=link href=/posts/microcorruption-hanoi/><span class=li></span>MicroCorruption: Hanoi</a></p><p><a class=link href=/posts/microcorruption-sydney/><span class=li></span>MicroCorruption: Sydney</a class="link"></p></section><section class=article-discussion><div id=disqus_thread></div><script type=application/javascript>window.disqus_config=function(){},function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById("disqus_thread").innerHTML="Disqus comments not available by default when the website is previewed locally.";return}var t=document,e=t.createElement("script");e.async=!0,e.src="//the-mess-of-nebula.disqus.com/embed.js",e.setAttribute("data-timestamp",+new Date),(t.head||t.body).appendChild(e)}()</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></section></div><section id=footer class="footer max-body-width"><p>Â© 2023 Eva Levanto</p><p><span>Powered by </span><a href=https://gohugo.io>Hugo</a><span> and the </span><a href=https://themes.gohugo.io/hugo-notepadium/>Notepadium</a></p></section><script defer type=text/javascript src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/MathJax.js?config=TeX-AMS-MML_HTMLorMML" integrity=sha384-e/4/LvThKH1gwzXhdbY2AsjR3rm7LHWyhIG5C0jiRfn8AN2eTN5ILeztWw0H9jmN crossorigin=anonymous>MathJax.Hub.Config({tex2jax:{inlineMath:[["$","$"],["\\(","\\)"]],displayMath:[["$$","$$"]],processEscapes:!0,processEnvironments:!0,skipTags:["script","noscript","style","textarea","pre"],TeX:{equationNumbers:{autoNumber:"AMS"},extensions:["AMSmath.js","AMSsymbols.js"]}}}),MathJax.Hub.Queue(function(){var e,t=MathJax.Hub.getAllJax();for(e=0;e<t.length;e+=1)t[e].SourceElement().parentNode.className+=" has-jax"}),MathJax.Hub.Config({TeX:{equationNumbers:{autoNumber:"AMS"}}})</script><script type=application/javascript>var doNotTrack=!1;doNotTrack||(window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","your-google-analytics-id","auto"),ga("send","pageview"))</script><script async src=https://www.google-analytics.com/analytics.js></script></div></body></html>